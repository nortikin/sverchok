<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Node API &mdash; Sverchok 1, 2, 0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=19f00094" />

  
    <link rel="shortcut icon" href="../_static/sverchock_icon_b.ico"/>
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/documentation_options.js?v=773c2105"></script>
        <script src="../_static/doctools.js?v=9a2dae69"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Sverchok API Documentation" href="api_documentation.html" />
    <link rel="prev" title="Adding new Node" href="add_new_node.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../main.html" class="icon icon-home">
            Sverchok
              <img src="../_static/title_big_b.svg" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                1, 2, 0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../introduction/introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation/installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_interface/user_interface.html">User interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tree_evaluation_system.html">Node tree evaluation system</a></li>
<li class="toctree-l1"><a class="reference internal" href="../data_structure/data_structure_index.html">Data structure</a></li>
<li class="toctree-l1"><a class="reference internal" href="../nodes.html">Nodes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/tutorials.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/celling.html">Celling design</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="contributing_to_sverchok.html">Contributing to sverchok</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="contribute_small_things.html">Contributing small things</a></li>
<li class="toctree-l2"><a class="reference internal" href="contribute_general.html">General guidelines</a></li>
<li class="toctree-l2"><a class="reference internal" href="add_new_node.html">Adding new Node</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Node API</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#class-definition">Class Definition</a></li>
<li class="toctree-l3"><a class="reference internal" href="#creating-node-custom-properties">Creating Node Custom Properties</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#draft-properties">Draft Properties</a></li>
<li class="toctree-l4"><a class="reference internal" href="#enum-properties">Enum Properties</a></li>
<li class="toctree-l4"><a class="reference internal" href="#dynamic-properties">Dynamic Properties</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#creating-node-buttons">Creating Node Buttons</a></li>
<li class="toctree-l3"><a class="reference internal" href="#node-sockets">Node Sockets</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#dynamic-sockets">Dynamic Sockets</a></li>
<li class="toctree-l4"><a class="reference internal" href="#socket-properties">Socket Properties</a></li>
<li class="toctree-l4"><a class="reference internal" href="#socket-vectorization-properties">Socket Vectorization Properties</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#business-logic">Business logic</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#data-vectorization">Data vectorization</a></li>
<li class="toctree-l4"><a class="reference internal" href="#data-structure">Data structure</a></li>
<li class="toctree-l4"><a class="reference internal" href="#bmesh-data-structure">BMesh data structure</a></li>
<li class="toctree-l4"><a class="reference internal" href="#tests">Tests</a></li>
<li class="toctree-l4"><a class="reference internal" href="#performance">Performance</a></li>
<li class="toctree-l4"><a class="reference internal" href="#printing-logging">Printing / Logging</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#node-registration">Node Registration</a></li>
<li class="toctree-l3"><a class="reference internal" href="#documentation">Documentation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#animation">Animation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#muting">Muting</a></li>
<li class="toctree-l3"><a class="reference internal" href="#nodes-with-dependencies">Nodes With Dependencies</a></li>
<li class="toctree-l3"><a class="reference internal" href="#json-import-export">JSON Import / Export</a></li>
<li class="toctree-l3"><a class="reference internal" href="#upgrade-node">Upgrade Node</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#improve-existing-node">Improve existing node</a></li>
<li class="toctree-l4"><a class="reference internal" href="#create-new-node-version">Create new node version</a></li>
<li class="toctree-l4"><a class="reference internal" href="#alpha-beta-node-state">Alpha/Beta Node State</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="api_documentation.html">Sverchok API Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="testing.html">Testing</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../main.html">Sverchok</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../main.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="contributing_to_sverchok.html">Contributing to sverchok</a></li>
      <li class="breadcrumb-item active">Node API</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/contributing/node_api.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="node-api">
<h1>Node API<a class="headerlink" href="#node-api" title="Link to this heading">¶</a></h1>
<p>This page claims to define all aspects of node creation. A brief introduction
to node creation is represented <a class="reference internal" href="add_new_node.html"><span class="doc">on this page</span></a>. Api
documentation of base class of all nodes can be found
<a class="reference external" href="http://nortikin.github.io/sverchok/apidocs/sverchok/node_tree.html">here</a>.
Also read the <a class="reference internal" href="#alpha-beta-node-state">Alpha/Beta Node State</a> section before creating new node.</p>
<p>The Code of a new node should be created in a separate file. The file should be placed in
one of the available categories in the <code class="docutils literal notranslate"><span class="pre">nodes</span></code> folder.</p>
<p>Usually the structure of the file looks like:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># This file is part of project Sverchok. It&#39;s copyrighted by the contributors</span>
<span class="c1"># recorded in the version control history of the file, available from</span>
<span class="c1"># its original location https://github.com/nortikin/sverchok/commit/master</span>
<span class="c1">#</span>
<span class="c1"># SPDX-License-Identifier: GPL3</span>
<span class="c1"># License-Filename: LICENSE</span>

<span class="kn">import</span> <span class="nn">bpy</span>

<span class="k">class</span> <span class="nc">Node</span><span class="p">:</span>
    <span class="o">...</span>

<span class="k">def</span> <span class="nf">register</span><span class="p">():</span>
    <span class="o">...</span>

<span class="k">def</span> <span class="nf">unregister</span><span class="p">():</span>
    <span class="o">...</span>
</pre></div>
</div>
<section id="class-definition">
<h2>Class Definition<a class="headerlink" href="#class-definition" title="Link to this heading">¶</a></h2>
<p>To create a node in Sverchok means to create a node class. The naming convention for
node classes is <code class="docutils literal notranslate"><span class="pre">SV</span> <span class="pre">+</span> <span class="pre">name</span> <span class="pre">of</span> <span class="pre">the</span> <span class="pre">node</span> <span class="pre">+</span> <span class="pre">Node</span></code></p>
<p>Standard Mix-ins for all node classes are
<code class="docutils literal notranslate"><span class="pre">sverchok.node_tree.SverchCustomTreeNode</span></code> and <code class="docutils literal notranslate"><span class="pre">bpy.types.Node</span></code></p>
<p>Optional Mix-ins can be found in <code class="docutils literal notranslate"><span class="pre">sverchok.utils.nodes_mixins</span></code></p>
<p>The Node class documentation string serves two purposes:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>Adding key words for searching</p></li>
<li><p>Adding a tool tip into the “Add Node” menu</p></li>
</ol>
</div></blockquote>
<p>There are two mandatory class variables:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">bl_idname</span></code> should repeat the name of the class</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">bl_label</span></code> is the common name of the node, used in the Node header and in the “Add Node” menus</p></li>
</ol>
</div></blockquote>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Node label can be defined dynamically in the <code class="docutils literal notranslate"><span class="pre">draw_label</span></code> method which
should return a string.</p>
</div>
<p>Also the class can define an optional <code class="docutils literal notranslate"><span class="pre">bl_icon</span></code> variable with a string of a
standard Blender icon for the node. To find all standard icons the Icon
Viewer add-on can be used, which is included in Blender by default.</p>
<p>It’s possible to define custom icons by including an <code class="docutils literal notranslate"><span class="pre">sv_icon</span></code>
variable. All custom icons are stored in the <code class="docutils literal notranslate"><span class="pre">sverchok.ui.icons</span></code> folder in png
format. The variable value should repeat the png file name without extension
and in upper case.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">SvSetMeshAttributeNode</span><span class="p">(</span><span class="n">SverchCustomTreeNode</span><span class="p">,</span> <span class="n">bpy</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">Node</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Triggers: set mesh attribute</span>
<span class="sd">    Tooltip: It adds an attribute to a mesh</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">bl_idname</span> <span class="o">=</span> <span class="s1">&#39;SvSetMeshAttributeNode&#39;</span>
    <span class="n">bl_label</span> <span class="o">=</span> <span class="s1">&#39;Set Mesh Attribute&#39;</span>
    <span class="n">bl_icon</span> <span class="o">=</span> <span class="s1">&#39;SORTALPHA&#39;</span>

    <span class="k">def</span> <span class="nf">draw_label</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;Label1&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prop</span> <span class="k">else</span> <span class="s2">&quot;Label2&quot;</span>
</pre></div>
</div>
</section>
<section id="creating-node-custom-properties">
<h2>Creating Node Custom Properties<a class="headerlink" href="#creating-node-custom-properties" title="Link to this heading">¶</a></h2>
<p>Properties are created in the same way as other areas of Blender.
<a class="reference external" href="https://docs.blender.org/api/current/bpy.props.html">Blender documentation</a></p>
<p>After properties are added they can be used as node buttons or socket
properties. Also they can be used for internal usage but it’s usually better to
use Custom properties (<code class="docutils literal notranslate"><span class="pre">node['prop_name']</span></code>) instead.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Using node properties for displaying on sockets is deprecated. Usually
sockets can define their own properties.</p>
</div>
<p>To make a node react to property changes they should define the update argument.
If no extra logic is required the argument can be defined thus
<code class="docutils literal notranslate"><span class="pre">update=data_structure.updateNode</span></code>.</p>
<p>In the case that a property change should cause sockets to be changed (created, removed..etc)
this can be done by creating a custom update method (usually in the node class) and passing a reference
to it in the update argument of the property.
The method expects to get the <code class="docutils literal notranslate"><span class="pre">self</span></code> and <code class="docutils literal notranslate"><span class="pre">context</span></code> parameters.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Also there is a direct method to update the node but it can’t be passed as
an argument to the update parameter directly. Instead it’s possible to use
lambda expression:
<code class="docutils literal notranslate"><span class="pre">update=lambda</span> <span class="pre">self,</span> <span class="pre">context:</span> <span class="pre">self.process_node(context)</span></code></p>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">NodeClass</span><span class="p">:</span>

    <span class="c1"># ...</span>

    <span class="k">def</span> <span class="nf">update_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
        <span class="c1"># some logic</span>
        <span class="n">updateNode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>

    <span class="n">some_mode</span><span class="p">:</span> <span class="n">bpy</span><span class="o">.</span><span class="n">props</span><span class="o">.</span><span class="n">BoolProperty</span><span class="p">(</span><span class="n">update</span><span class="o">=</span><span class="n">updateNode</span><span class="p">)</span>
    <span class="n">another_mode</span><span class="p">:</span> <span class="n">bpy</span><span class="o">.</span><span class="n">props</span><span class="o">.</span><span class="n">BoolProperty</span><span class="p">(</span><span class="n">update</span><span class="o">=</span><span class="n">update_type</span><span class="p">)</span>
</pre></div>
</div>
<section id="draft-properties">
<h3>Draft Properties<a class="headerlink" href="#draft-properties" title="Link to this heading">¶</a></h3>
<p>Nodes can have draft properties which will be used instead of normal ones in
draft mode of a tree. Draft properties are defined in the same way as normal
ones. Also the node should use <code class="docutils literal notranslate"><span class="pre">DraftMode</span></code> mix-in, define
<code class="docutils literal notranslate"><span class="pre">draft_properties_mapping</span></code> class variable with mapping between standard
properties and draft ones, and <code class="docutils literal notranslate"><span class="pre">does_support_draft_mode</span></code> method which should
return boolean value.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">NodeClass</span><span class="p">(</span><span class="n">sverchok</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">nodes_mixins</span><span class="o">.</span><span class="n">DraftMode</span><span class="p">):</span>

    <span class="c1"># ...</span>

    <span class="n">some_mode</span><span class="p">:</span> <span class="n">bpy</span><span class="o">.</span><span class="n">props</span><span class="o">.</span><span class="n">BoolProperty</span><span class="p">(</span><span class="n">update</span><span class="o">=</span><span class="n">updateNode</span><span class="p">)</span>
    <span class="n">some_mode_draft</span><span class="p">:</span> <span class="n">bpy</span><span class="o">.</span><span class="n">props</span><span class="o">.</span><span class="n">BoolProperty</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;[D] Some Mode&#39;</span><span class="p">,</span> <span class="n">update</span><span class="o">=</span><span class="n">updateNode</span><span class="p">)</span>

    <span class="n">draft_properties_mapping</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">some_mode</span> <span class="o">=</span> <span class="s1">&#39;some_mode_draft&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">does_support_draft_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span>
</pre></div>
</div>
</section>
<section id="enum-properties">
<h3>Enum Properties<a class="headerlink" href="#enum-properties" title="Link to this heading">¶</a></h3>
<p>Enums are created in the same way as in other Blender UI parts. In case Enums
are generated dynamically they always should be stored somewhere in Python
memory. There are <a class="reference external" href="https://github.com/nortikin/sverchok/issues/4316">known cases</a> when Blender crashes during rendering when UI
expose dynamic enums which do not store their content.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>There is now <code class="docutils literal notranslate"><span class="pre">utils.handle_blender_data.keep_enum_reference</span></code> decorator
which can be used with dynamic enums. The decorator assign enum items to a
Python variable what solves the problem above.</p>
</div>
<p>Enum items can have custom icons. Custom icons should be stored in the
<code class="docutils literal notranslate"><span class="pre">sverchok.ui.icons</span></code> folder. To use custom icons the <code class="docutils literal notranslate"><span class="pre">ui.sv_icons.custom_icon</span></code>
function should be used. It expects the name of the file in upper case without
extension and returns the index of the icon.</p>
</section>
<section id="dynamic-properties">
<h3>Dynamic Properties<a class="headerlink" href="#dynamic-properties" title="Link to this heading">¶</a></h3>
<p>There are several nodes which generate dynamic properties - List Levels and
Switcher nodes. Dynamic properties are properties which are generated
depending on the size of input data. The best way to generate dynamic properties
is to use PropertyGroups together with Collection properties. Displaying
such properties is possible with for loop inside UI code. The right place to upgrade
properties is in the <code class="docutils literal notranslate"><span class="pre">process</span></code> method.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Dynamic properties should always store values changed by the user, even if they
are not displayed anymore. Otherwise it will lead to degradation of node
tree “code”. Otherwise, whenever properties are removed and restored a user would always
be forced to repeat choices - this is quite unexpected and time consuming.</p>
<p>In the future the generation of properties (currently done from inside <code class="docutils literal notranslate"><span class="pre">process</span></code> method) should
move to some other method because the <code class="docutils literal notranslate"><span class="pre">process</span></code> method itself should become an
abstract method.</p>
</div>
</section>
</section>
<section id="creating-node-buttons">
<h2>Creating Node Buttons<a class="headerlink" href="#creating-node-buttons" title="Link to this heading">¶</a></h2>
<p>There are 4 places where a node can show its properties:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>Node interface</p></li>
<li><p>Node tab of the Property panel of the Node editor</p></li>
<li><p>Tool tab of the Property panel of the 3d Viewport editor</p></li>
<li><p>Context menu</p></li>
</ol>
</div></blockquote>
<p>The Node interface is the appropriate place for adding properties which are used
regularly during work with a node tree. They should be defined in
<code class="docutils literal notranslate"><span class="pre">sv_draw_buttons</span></code> method which expects <code class="docutils literal notranslate"><span class="pre">context</span></code> and <code class="docutils literal notranslate"><span class="pre">layout</span></code> arguments.</p>
<p>The Property panel of the Node editor is a good place for showing properties which
are rarely changed or should be changed only once. To make properties appear on that panel
place them inside a <code class="docutils literal notranslate"><span class="pre">sv_draw_buttons_ext</span></code> method, this method also expects <code class="docutils literal notranslate"><span class="pre">context</span></code> and <code class="docutils literal notranslate"><span class="pre">layout</span></code>
arguments.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Node</span><span class="p">:</span>
    <span class="n">value</span><span class="p">:</span> <span class="n">IntProperty</span><span class="p">()</span>
    <span class="n">mode</span><span class="p">:</span> <span class="n">BoolProperty</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">sv_draw_buttons</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">layout</span><span class="p">):</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">prop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">sv_draw_buttons_ext</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">layout</span><span class="p">):</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">prop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;mode&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>There are some nodes for which it is useful to see properties from the 3D Viewport editor.
Node with such properties should use <code class="docutils literal notranslate"><span class="pre">utils.nodes_mixins.Show3DProperties</span></code>
mix-in. UI code should be placed in <code class="docutils literal notranslate"><span class="pre">draw_buttons_3dpanel</span></code> method. It expects
<code class="docutils literal notranslate"><span class="pre">layout</span></code> argument and the optional <code class="docutils literal notranslate"><span class="pre">in_menu</span></code> argument which is False by default.
UI should obtain only one string. It’s possible to show UI on several lines but
in this case <code class="docutils literal notranslate"><span class="pre">utils.node_mixins.Popup3DMenu</span></code> operator should be used. The
operator calls the same <code class="docutils literal notranslate"><span class="pre">draw_buttons_3dpanel</span></code> method but with <code class="docutils literal notranslate"><span class="pre">in_menu</span></code>
argument as True.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Node</span><span class="p">(</span><span class="n">Show3DProperties</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">draw_buttons_3dpanel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">layout</span><span class="p">,</span> <span class="n">in_menu</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">in_menu</span><span class="p">:</span>
            <span class="n">menu</span> <span class="o">=</span> <span class="n">layout</span><span class="o">.</span><span class="n">row</span><span class="p">(</span><span class="n">align</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">operator</span><span class="p">(</span><span class="s1">&#39;node.popup_3d_menu&#39;</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Show: &quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">&quot;&#39;</span><span class="p">)</span>
            <span class="n">menu</span><span class="o">.</span><span class="n">tree_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">id_data</span><span class="o">.</span><span class="n">name</span>
            <span class="n">menu</span><span class="o">.</span><span class="n">node_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">row</span><span class="o">.</span><span class="n">prop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;mode1&#39;</span><span class="p">)</span>
            <span class="n">row</span><span class="o">.</span><span class="n">prop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;mode2&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Also optionally nodes can show their properties in the context menu. The Node class should
override the <code class="docutils literal notranslate"><span class="pre">rclick_menu</span></code> method which expects <code class="docutils literal notranslate"><span class="pre">context</span></code> and <code class="docutils literal notranslate"><span class="pre">layout</span></code> arguments.</p>
</section>
<section id="node-sockets">
<h2>Node Sockets<a class="headerlink" href="#node-sockets" title="Link to this heading">¶</a></h2>
<p>Node sockets are created in <code class="docutils literal notranslate"><span class="pre">sv_init</span></code> method. <code class="docutils literal notranslate"><span class="pre">new</span></code> method of input and
output collections of sockets should be used. It expects name of a socket type
and name socket itself. These names are shown in UI and also usually are used
as identifiers. Whole list of available socket types can be found in
<code class="docutils literal notranslate"><span class="pre">core.sockets</span></code> module. The new method returns newly created socket which
can be used for setting its extra parameters.</p>
<p>Usually sockets expose their default parameters. By default they are switched
off. The proper way to make to show its property is to assign True value to
<code class="docutils literal notranslate"><span class="pre">use_prop</span></code> attribute of the socket. Default value can be changed in
<code class="docutils literal notranslate"><span class="pre">default_property</span></code> attribute.</p>
<p><code class="docutils literal notranslate"><span class="pre">SvStringsSocket</span></code> type has two types of default values. Current type stored
in <code class="docutils literal notranslate"><span class="pre">default_property_type</span></code> attribute which can receive either ‘float’ or
‘int’ values. Default values are stored in <code class="docutils literal notranslate"><span class="pre">default_float_property</span></code> and
<code class="docutils literal notranslate"><span class="pre">default_int_property</span></code> attributes.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Node</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">sv_init</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
        <span class="n">socket</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s1">&#39;SvStringsSocket&#39;</span><span class="p">,</span> <span class="s2">&quot;Size&quot;</span><span class="p">)</span>
        <span class="n">socket</span><span class="o">.</span><span class="n">use_prop</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">socket</span><span class="o">.</span><span class="n">default_float_property</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s1">&#39;SvVerticesSocket&#39;</span><span class="p">,</span> <span class="s2">&quot;Verts&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Alternative way of creating input sockets is using <code class="docutils literal notranslate"><span class="pre">sv_new_input</span></code> method.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Node</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">sv_init</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sv_new_input</span><span class="p">(</span><span class="s1">&#39;SvStringsSocket&#39;</span><span class="p">,</span> <span class="s2">&quot;Size&quot;</span><span class="p">,</span> <span class="n">use_prop</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                          <span class="n">default_float_property</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<section id="dynamic-sockets">
<h3>Dynamic Sockets<a class="headerlink" href="#dynamic-sockets" title="Link to this heading">¶</a></h3>
<p>Dynamic sockets are shown only on certain conditions. There are 3 categories
of them:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>Socket is shown if a node has certain properties.</p></li>
<li><p>Socket is shown if other socket is connected.</p></li>
<li><p>Socket is shown if node has appropriate input data.</p></li>
</ol>
</div></blockquote>
<p>There are many ways to show / hide sockets. First of all it’s possible to use
Blender standard API for adding and removing sockets. Most resent nodes use
<code class="docutils literal notranslate"><span class="pre">hide_safe</span></code> attribute of sockets. Disadvantage of this method is that sockets
are not really deleted and can be shown with <cite>Ctrl+h</cite> by user. The proper
way now is to use standard Blender <code class="docutils literal notranslate"><span class="pre">enabled</span></code> attribute.</p>
<p>When type of a socket should be changed it’s possible to use
<code class="docutils literal notranslate"><span class="pre">data_structure.changable_sockets</span></code> function or <code class="docutils literal notranslate"><span class="pre">replace_socket</span></code> method of a
socket. First function changes type of output sockets dependently on type of
a socket connected to input one. With the second method you have to define new
type of a socket by yourself.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Change type of a socket is tricky part. Because it’s related with removing,
adding, moving sockets and links in a tree. Also it can be quite inefficient
because Blender does not expose API which would allow to search connected
neighbour sockets efficiently. But usually it’s not a bottle neck in such
cases.</p>
</div>
<p>To generate sockets upon changes of node properties is possible in <code class="docutils literal notranslate"><span class="pre">update</span></code>
method of properties.</p>
<p>To generate sockets upon changes in node connections is possible in
<code class="docutils literal notranslate"><span class="pre">sv_update</span></code> method of nodes. This method can be called quite intensively so
it’s wise to expense resources carefully.</p>
<p>To generate sockets upon changes of input data of a node was quite controversial
idea. Now it’s only used in Dictionary output node. The problem is that this can
easily lead to losses of user connections what breaks node setups. For example
in Geometry Nodes project there was a decision that sockets should be
independent to data layer. So to generate such nodes is not recommended now.
If there is no way but to have this functionality possible solution could be
to add a button to a node which would recreate sockets explicitly.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Node</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">mode_update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;Value&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">enabled</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process_node</span><span class="p">()</span>

    <span class="n">mode</span><span class="p">:</span> <span class="n">BoolProperty</span><span class="p">(</span><span class="n">update</span><span class="o">=</span><span class="n">mode_update</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">sv_init</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s1">&#39;SvStringsSocket&#39;</span><span class="p">,</span> <span class="s2">&quot;Value&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">use_prop</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s1">&#39;SvStringsSocket&#39;</span><span class="p">,</span> <span class="s2">&quot;Value&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">sv_update</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">data_structure</span><span class="o">.</span><span class="n">changable_sockets</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;Value&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;Value&quot;</span><span class="p">])</span>
</pre></div>
</div>
</section>
<section id="socket-properties">
<h3>Socket Properties<a class="headerlink" href="#socket-properties" title="Link to this heading">¶</a></h3>
<dl class="simple">
<dt>label</dt><dd><p>Expects a string which is used instead of a socket name in UI.</p>
</dd>
<dt>use_prop</dt><dd><p>Expects boolean value. If true the socket will display its default property.</p>
</dd>
</dl>
<img alt="https://user-images.githubusercontent.com/28003269/180741280-683987fa-e10c-47e1-91e0-807311697fea.png" class="align-right" src="https://user-images.githubusercontent.com/28003269/180741280-683987fa-e10c-47e1-91e0-807311697fea.png" />
<dl>
<dt>show_property_type (SvStringsSocket)</dt><dd><p>It adds icon to switch default type of the string socket</p>
</dd>
<dt>custom_draw</dt><dd><p>Expects name of a method of the node of the socket. If defined the method
will be used draw UI elements for the socket.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Node</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">custom_draw_socket</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">socket</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">layout</span><span class="p">):</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">prop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;node_property&quot;</span><span class="p">)</span>
</pre></div>
</div>
</dd>
<dt>quick_link_to_node</dt><dd><p>Expects a string of node <cite>bl_idname`</cite>. This will add an operator which can
create quick link to the given node.</p>
</dd>
<dt>link_menu_handler</dt><dd><p>Expects a string of class name defined inside node of the socket. This only
works when displaying quick links is in multiple values mode. In the class
its possible to define extra nodes for connections. This is analog of
creating nodes during dragging a link from a socket in Blender 3.1.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Node</span><span class="p">:</span>
    <span class="k">class</span> <span class="nc">MenuHandler</span><span class="p">:</span>
        <span class="nd">@classmethod</span>
        <span class="k">def</span> <span class="nf">get_items</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">socket</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Return list of extra options for the menu&quot;&quot;&quot;</span>
            <span class="k">return</span> <span class="p">[(</span><span class="s1">&#39;KEY&#39;</span><span class="p">,</span> <span class="s2">&quot;Name&quot;</span><span class="p">,</span> <span class="s2">&quot;Description&quot;</span><span class="p">),</span> <span class="p">]</span>

        <span class="nd">@classmethod</span>
        <span class="k">def</span> <span class="nf">on_selected</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">tree</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">socket</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;In this method the node should be created and linked to the socket&quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;KEY&#39;</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Hello world!&quot;</span><span class="p">)</span>
</pre></div>
</div>
</dd>
<dt>prop_name</dt><dd><p>Expects name of a node property to display in UI of the socket.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>This is deprecated way to display default properties for sockets. Use
<code class="docutils literal notranslate"><span class="pre">use_prop</span></code> attribute instead.</p>
</div>
</dd>
<dt>object_kinds (SvObjectSocket)</dt><dd><p>Expects string value of object type to socket to display as possible choice.
Its also possible to pass several types which should be separate by only
comma: ‘MESH,CURVE,SURFACE,META,FONT,VOLUME,EMPTY,CAMERA,LIGHT’</p>
</dd>
<dt>expanded (SvVerticesSocket, SvQuaternionSocket, SvColorSocket)</dt><dd><p>Expects boolean value. It’s responsible for the way of the socket to display
the socket value.</p>
</dd>
</dl>
</section>
<section id="socket-vectorization-properties">
<h3>Socket Vectorization Properties<a class="headerlink" href="#socket-vectorization-properties" title="Link to this heading">¶</a></h3>
<p>Vectorization system is on
<a class="reference internal" href="#experimental-vectorization"><span class="std std-ref">experimental stage</span></a></p>
<dl class="simple">
<dt>is_mandatory</dt><dd><p>Expects boolean value. If True the node can’t perform its function without
data from the socket.</p>
</dd>
<dt>nesting_level</dt><dd><p>Expects integer value. Describes the expected shape of input data.</p>
<ul class="simple">
<li><p>3 for vectors lists (Default for Vertices Socket)</p></li>
<li><p>2 for number lists (Default)</p></li>
<li><p>1 for single item</p></li>
</ul>
</dd>
<dt>default_mode</dt><dd><p>Expects one of the next strings:</p>
<ul class="simple">
<li><p>‘NONE’ to leave empty</p></li>
<li><p>‘EMPTY_LIST’ for [[]] (Default)</p></li>
<li><p>‘MATRIX’ for Matrix()</p></li>
<li><p>‘MASK’ for [[True]]</p></li>
</ul>
</dd>
<dt>pre_processing</dt><dd><p>Expects one of the next strings:</p>
<ul class="simple">
<li><p>‘ONE_ITEM’ for values like the number of subdivision (one value per object).
It will match one value per object independently if the list is [[1,2]]
or [[1],[2]]. In case of more complex inputs no preprocessing will be made.</p></li>
<li><p>‘NONE’ not doing any preprocessing. (Default)</p></li>
</ul>
</dd>
</dl>
</section>
</section>
<section id="business-logic">
<h2>Business logic<a class="headerlink" href="#business-logic" title="Link to this heading">¶</a></h2>
<p>The main work of the node is happening inside <code class="docutils literal notranslate"><span class="pre">process</span></code> method which does
not expect any arguments.</p>
<p>The whole process can be split into 3 steps:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>Extract data from sockets.</p></li>
<li><p>Handle the data.</p></li>
<li><p>Record result into output sockets.</p></li>
</ol>
</div></blockquote>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In future it is planned to convert the method into abstract one. In this case
a node will get parameters via some arguments.</p>
</div>
<p>For reading data from sockets their <code class="docutils literal notranslate"><span class="pre">sv_get</span></code> method can be used.
It has tow important parameters. <code class="docutils literal notranslate"><span class="pre">default</span></code> parameter expects any
data which will be returned in case if input socket does not have any external
data. <code class="docutils literal notranslate"><span class="pre">deepcopy</span></code> parameter expects False value if input data is not modified
by the node. The node can work quite more efficient if deepcopy is False. But
if a node do modify the data the parameter should be with default value,
otherwise other nodes which use the same data will get unexpected results.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Many nodes on this stage also do such optimization as checking connection of
their output sockets and if they are not connected cancel their father
execution. Really it’s not recommended in new nodes. The right place for
such optimization is execution system.</p>
</div>
<p>After handling input data <code class="docutils literal notranslate"><span class="pre">sv_set</span></code> method of sockets can be used for
saving result. It expects only one parameter - data.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Node</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">process</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="s1">&#39;My Socket&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sv_get</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="p">[],</span> <span class="n">deepcopy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">handle_data</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="s1">&#39;My Socket&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sv_set</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Sometimes node does not have enough data to perform its function in this case
it should pass available data to output sockets unmodified. It’s important
because the whole node tree will stop working otherwise.</p>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Also <code class="docutils literal notranslate"><span class="pre">sv_get</span></code> method has third parameter - <code class="docutils literal notranslate"><span class="pre">implicit_conversions</span></code>. It
expects one of the values of <code class="docutils literal notranslate"><span class="pre">core.socket_conversions.ConversionPolicies</span></code>
enum. It’s purpose is to convert format of output data of previous nodes to
format of input data of current node. For example via Conversion Policy
conversion simple values to vectors is happening. Usually such settings are
applied globally to all sockets but sometimes it can be useful to override
them via the parameter (not single node do this currently though).</p>
</div>
<section id="data-vectorization">
<h3>Data vectorization<a class="headerlink" href="#data-vectorization" title="Link to this heading">¶</a></h3>
<p>All nodes should be designed in a way that they can handle not only one object
but multiple of them. That is called vectorization in Sverchok. For example if
a node works with vertices of an object it should handle list of lists of
vertices.</p>
<p>It can happen that some input data has one number of objects and another
input data has another number of objects. In this case a node should perform
data matching operation. Usually it means that data with shorter number of
objects should repeat them to match them to number of objects of the longest
data. Repeating objects usually happens in two ways.</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>Last object fills all missing ones. For example: <code class="docutils literal notranslate"><span class="pre">[1,</span> <span class="pre">2,</span> <span class="pre">3]</span></code> will be
converted into <code class="docutils literal notranslate"><span class="pre">[1,</span> <span class="pre">2,</span> <span class="pre">3,</span> <span class="pre">3</span> <span class="pre">,3</span> <span class="pre">,3]</span></code> if number of required objects is 6.</p></li>
<li><p>Objects start to repeat from start of a list (cycling). For example:
<code class="docutils literal notranslate"><span class="pre">[1,</span> <span class="pre">2,</span> <span class="pre">3]</span></code> will be converted into <code class="docutils literal notranslate"><span class="pre">[1,</span> <span class="pre">2,</span> <span class="pre">3,</span> <span class="pre">1,</span> <span class="pre">2,</span> <span class="pre">3]</span></code> if number of
required objects is 6.</p></li>
</ol>
</div></blockquote>
<p>Usually number of objects is determined by the longest input data. Sometimes
the number can be limited by some particular input in case it does not have
sense to repeat it.</p>
<p>There are helping functions / generators to perform data matching in
<code class="docutils literal notranslate"><span class="pre">data_structure</span></code> module. Generators are preferable before functions.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Node</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">process</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span><span class="o">.</span><span class="n">sv_get</span><span class="p">(</span><span class="n">deepcopy</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="p">[[]])</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">]</span>
        <span class="n">max_len</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">len</span><span class="p">,</span> <span class="n">params</span><span class="p">))</span>
        <span class="n">out</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">fd</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">d</span>  <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">max_len</span><span class="p">),</span> <span class="o">*</span><span class="n">make_repeaters</span><span class="p">(</span><span class="n">params</span><span class="p">)):</span>
            <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">handle_data</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">fd</span><span class="p">,</span> <span class="n">m</span><span class="p">))</span>

        <span class="n">out_verts</span><span class="p">,</span> <span class="n">out_edges</span><span class="p">,</span> <span class="n">out_faces</span><span class="p">,</span> <span class="n">out_face_data</span><span class="p">,</span> <span class="n">out_mask</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">out</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="s1">&#39;Verts&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sv_set</span><span class="p">(</span><span class="n">out_verts</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="s1">&#39;Edges&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sv_set</span><span class="p">(</span><span class="n">out_edges</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="s1">&#39;Faces&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sv_set</span><span class="p">(</span><span class="n">out_faces</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="s1">&#39;Face data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sv_set</span><span class="p">(</span><span class="n">out_face_data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="s1">&#39;Mask&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sv_set</span><span class="p">(</span><span class="n">out_mask</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note" id="experimental-vectorization">
<p class="admonition-title">Note</p>
<p>There are two experimental approaches to automate data matching. One can
be found in <code class="docutils literal notranslate"><span class="pre">utils.nodes_mixins.recursive_nodes</span></code> and another in
<code class="docutils literal notranslate"><span class="pre">utils.vectorize</span></code> modules. Both of them can handle not only list of
objects but and nested to each other lists of objects with arbitrary
nestedness and shape. It leads to two disadvantages:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>It make the code difficult to understand, to support and to debug.
Even for user its more difficult to handle data with complex shape.</p></li>
<li><p>Vectorization itself is very expensive thing because it uses pure
Python loops. And such complex vectorization system is even more
expensive.</p></li>
</ol>
</div></blockquote>
<p>Also any vectorization can be performed with loop nodes which can create
more clear representation data handling. So this modules should prove first
which problems they are going to solve which can’t be tackled in another way
and so they can’t be recommended for use for now.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In future vectorization should leave the nodes area and arrive to execution
system. In this case nodes only have to add information to sockets to give to
execution system to know how to match data.</p>
</div>
</section>
<section id="data-structure">
<h3>Data structure<a class="headerlink" href="#data-structure" title="Link to this heading">¶</a></h3>
<p>Sverchok can operate on vide variation of data structures. The most important
one is mesh data structure. Sverchok uses <em>Face-vertex</em> representation of them.
Representation is a simple list of vertices, and a set of edges and polygons
that point to the vertices they use.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Usually list of vertices, edges and polygons are ordinary Python lists.
Vertices can be represented as numpy arrays. If a node is generator it can
have an option in which format to output vertices. If a node has vertices as
an input it should output them in the same format in which they came.</p>
<p>For edges and polygons it was decided not to use numpy arrays due little
performance benefit and in case of n-gons it’s not trivial how to store and
handle them as numpy arrays.</p>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># simple triangle</span>
<span class="n">vertices</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)]</span>
<span class="n">edges</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)]</span>
<span class="n">polygons</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">]</span>
</pre></div>
</div>
<p>For vertices there is <code class="docutils literal notranslate"><span class="pre">SvVerticesSocket</span></code> socket type. For edges and faces
there is <code class="docutils literal notranslate"><span class="pre">SvStringsSocket</span></code> socket type. The last one is also used for lists
of numbers (floats, integers).</p>
<p>For storing mesh attributes Sverchok uses simple numbers or more complex data
as colors, texts and vectors. Such lists should store values per mesh element.
Color data passes via <code class="docutils literal notranslate"><span class="pre">SvColorSocket</span></code>, number via <code class="docutils literal notranslate"><span class="pre">SvStringsSocket</span></code>, strings
via <code class="docutils literal notranslate"><span class="pre">SvTextSocket</span></code>.</p>
<p>For orienting meshes in space Blender Matrix and Quaternions are used.
Historically they has next format - <code class="docutils literal notranslate"><span class="pre">[matrix,</span> <span class="pre">matrix,</span> <span class="pre">...]</span></code> but this format
can move only whole mesh. For this reason some nodes also support such format -
<code class="docutils literal notranslate"><span class="pre">[[matrix,</span> <span class="pre">matrix,</span> <span class="pre">...],</span> <span class="pre">[matrix,</span> <span class="pre">...]]</span></code>. In this cases matrix can be used
for moving separate elements of a mesh. Socket types for them are
<code class="docutils literal notranslate"><span class="pre">SvMatrixSocket</span></code> and <code class="docutils literal notranslate"><span class="pre">SvQuaternionSocket</span></code>.</p>
<p>Sverchok has family of mathematical objects such as Curves, Surfaces,
Feilds, Solids. All of them, except Solids, are defined as Python classes.
Solids are used from FreeCAD library. They all have dedicated to them sockets
in the <code class="docutils literal notranslate"><span class="pre">core.sockets</span></code> module.</p>
<p>Also there are some other data structures as Blender objects, File paths, svg,
Pulga forces, Dictionaries.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Dictionary has rather experimental stage and should prove in which area
they can be used efficiently.</p>
</div>
</section>
<section id="bmesh-data-structure">
<h3>BMesh data structure<a class="headerlink" href="#bmesh-data-structure" title="Link to this heading">¶</a></h3>
<p>For performing operations over geometry it’s possible to create you own
algorithms. But also Blender has a library of some basic geometry operations.
This library uses special BMesh data structure. It’s similar to Half-edge
data structure. To convert data from Sverchok format to BMesh and vice versa
there is <code class="docutils literal notranslate"><span class="pre">utils.sv_bmesh_utils</span></code> module.</p>
</section>
<section id="tests">
<h3>Tests<a class="headerlink" href="#tests" title="Link to this heading">¶</a></h3>
<p>Ideally nodes should go with some tests. But currently there is no framework
for automation of tests creation. So it’s optional now. More about tests in the
separate section <a class="reference internal" href="testing.html"><span class="doc">Testing</span></a>.</p>
</section>
<section id="performance">
<h3>Performance<a class="headerlink" href="#performance" title="Link to this heading">¶</a></h3>
<figure class="align-right" id="id1">
<a class="reference internal image-reference" href="https://user-images.githubusercontent.com/28003269/167471557-e10fb5f4-af31-47a2-86f2-e826a253fd06.png"><img alt="https://user-images.githubusercontent.com/28003269/167471557-e10fb5f4-af31-47a2-86f2-e826a253fd06.png" src="https://user-images.githubusercontent.com/28003269/167471557-e10fb5f4-af31-47a2-86f2-e826a253fd06.png" style="width: 300px;" /></a>
<figcaption>
<p><span class="caption-text">Dot graph <a class="reference external" href="https://github.com/jrfonseca/gprof2dot">https://github.com/jrfonseca/gprof2dot</a></span><a class="headerlink" href="#id1" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<figure class="align-right" id="id2">
<a class="reference internal image-reference" href="https://user-images.githubusercontent.com/28003269/167472803-225b8fd9-4584-4eb5-b7e8-f0ce9695f604.png"><img alt="https://user-images.githubusercontent.com/28003269/167472803-225b8fd9-4584-4eb5-b7e8-f0ce9695f604.png" src="https://user-images.githubusercontent.com/28003269/167472803-225b8fd9-4584-4eb5-b7e8-f0ce9695f604.png" style="width: 300px;" /></a>
<figcaption>
<p><span class="caption-text">Icicle style <a class="reference external" href="https://github.com/jiffyclub/snakeviz">https://github.com/jiffyclub/snakeviz</a></span><a class="headerlink" href="#id2" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<p>Performance of the nodes is very important and quite a big problem in Sverchok
currently. Using pure Python is quite weak solution. First step to improve
performance is to rewrite code with numpy library if it’s possible.</p>
<p>Sverchok has tool with UI to measure performance of separate nodes or a whole
tree. It’s located in the Tree Profiling panel in Sverchok tab of Property
panel. It only appears if the Developer mode is enabled in the add-on settings.</p>
<p>In Node Tree Update mode the performance of a whole tree will be measured. To
measure performance of separate nodes their process method should be marked with
<code class="docutils literal notranslate"><span class="pre">utils.profile.profile</span></code> decorator.</p>
<p>After measuring the performance the result can be outputted in the console which
is standard output of cProfile Python module. Also the result can be saved in
separate file which can be visualized with another tools.</p>
</section>
<section id="printing-logging">
<h3>Printing / Logging<a class="headerlink" href="#printing-logging" title="Link to this heading">¶</a></h3>
<figure class="align-right" id="id3">
<a class="reference internal image-reference" href="https://user-images.githubusercontent.com/28003269/180702647-c25d8b58-ed2d-4a7b-98ce-d6aaa594d475.png"><img alt="https://user-images.githubusercontent.com/28003269/180702647-c25d8b58-ed2d-4a7b-98ce-d6aaa594d475.png" src="https://user-images.githubusercontent.com/28003269/180702647-c25d8b58-ed2d-4a7b-98ce-d6aaa594d475.png" style="width: 400px;" /></a>
<figcaption>
<p><span class="caption-text">Logging level can be set in the add-on settings.</span><a class="headerlink" href="#id3" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<p>Printing and profiling are very expensive operations. Also console can fastly
turn into unreadable mess. So it’s better to avoid using them inside node code.
During debugging it’s valid to use print function but it should removed in the
end.</p>
<p>Usually logging can be don in some operators in this case you can use loggers
from <code class="docutils literal notranslate"><span class="pre">utils.logging</span></code> module or by using <code class="docutils literal notranslate"><span class="pre">node.debug</span></code>, <code class="docutils literal notranslate"><span class="pre">node.info</span></code> and
other aliases.</p>
<p>If a node rises an error it will appear in console in next format: <code class="docutils literal notranslate"><span class="pre">data</span> <span class="pre">and</span>
<span class="pre">time</span> <span class="pre">[logging</span> <span class="pre">level]</span> <span class="pre">module</span> <span class="pre">name:line</span> <span class="pre">number</span> <span class="pre">:</span> <span class="pre">error</span> <span class="pre">name</span></code></p>
<p>Traceback is switch off for all logging levels except debug one. If you need it
make sure that you have appropriate logging level in the settings.</p>
</section>
</section>
<section id="node-registration">
<h2>Node Registration<a class="headerlink" href="#node-registration" title="Link to this heading">¶</a></h2>
<p>After a node was created it should be registered to appear in Blender interface.
It can be done in function with <code class="docutils literal notranslate"><span class="pre">register</span></code> name in the same module with node
class. This function will be called whenever the add-on is enabled. For the
class registration standard Blender function is used.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Node</span><span class="p">:</span>
    <span class="o">...</span>

<span class="k">def</span> <span class="nf">register</span><span class="p">():</span>
    <span class="n">bpy</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">register_class</span><span class="p">(</span><span class="n">Node</span><span class="p">)</span>
</pre></div>
</div>
<p>Also node should be placed in some existing category by adding its <code class="docutils literal notranslate"><span class="pre">bl_idname</span></code>
to the <code class="docutils literal notranslate"><span class="pre">index.md</span></code> file.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>In case new node should obtain new category it’s possible to create it in
<code class="docutils literal notranslate"><span class="pre">ui/nodeview_space_menu</span></code> module. Here is example of adding a category
with name Test.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">menu_structure</span> <span class="o">=</span> <span class="p">[</span>
    <span class="o">...</span><span class="p">,</span>
    <span class="p">[</span><span class="s2">&quot;NODEVIEW_MT_AddTest&quot;</span><span class="p">,</span> <span class="s1">&#39;ICON_NAME&#39;</span><span class="p">],</span>
    <span class="o">...</span><span class="p">,</span>
    <span class="p">]</span>

<span class="n">classes</span> <span class="o">=</span> <span class="p">[</span>
    <span class="o">...</span><span class="p">,</span>
    <span class="n">make_class</span><span class="p">(</span><span class="s1">&#39;Test&#39;</span><span class="p">,</span> <span class="s2">&quot;Test&quot;</span><span class="p">),</span>
    <span class="o">...</span><span class="p">,</span>
    <span class="p">]</span>
</pre></div>
</div>
<p>Also the category should be added to <code class="docutils literal notranslate"><span class="pre">index.md</span></code> file similar to other
categories.</p>
</div>
<p>When the add-on is disabled or reloaded its classes should be unregister. To
unregister a node is possible in function with name <code class="docutils literal notranslate"><span class="pre">unregister</span></code> in the same
module with Node class.</p>
</section>
<section id="documentation">
<h2>Documentation<a class="headerlink" href="#documentation" title="Link to this heading">¶</a></h2>
<p>When new node is added it’s strongly recommended to add its documentation.
Without it, in most cases, users will hardly able to use the node and also
it can be difficult to distinguish a bug because the desired behaviour was not
proclaimed.</p>
<p>To add documentation to a node file with documentation (name_of_the_node.rst)
should be added to the <code class="docutils literal notranslate"><span class="pre">docs.nodes.node_category</span></code> folder.</p>
<p>For generating documentation <a class="reference external" href="https://www.sphinx-doc.org/en/master/">Sphinx library</a> is used. Also
<a class="reference external" href="https://github.com/readthedocs/sphinx_rtd_theme">Read the Docs</a> Sphinx theme is used. So both libraries should be available
if you want to build documentation locally. There is <code class="docutils literal notranslate"><span class="pre">docs/make.bat</span></code> file
which builds the documentation into <code class="docutils literal notranslate"><span class="pre">docs/_build</span></code> (excluded from git) folder.</p>
<p>There is action which will automatically build and publish documentation on the
next address - <a class="reference external" href="http://nortikin.github.io/sverchok/docs/main.html">http://nortikin.github.io/sverchok/docs/main.html</a>, whenever
changes will be introduced in master on GitHub.</p>
</section>
<section id="animation">
<h2>Animation<a class="headerlink" href="#animation" title="Link to this heading">¶</a></h2>
<p>There are nodes which should be updated upon frame change. Usually they read
some data from a Blender scene. To make a node to be updated every frame it’s
enough to override <code class="docutils literal notranslate"><span class="pre">is_animation_dependent</span></code> node attribute with True value.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Buttons should be displayed via <code class="docutils literal notranslate"><span class="pre">sv_draw_buttons</span></code> method otherwise the
node won’t display extra property which can be used by user to disable
updates for the current node.</p>
</div>
</section>
<section id="muting">
<h2>Muting<a class="headerlink" href="#muting" title="Link to this heading">¶</a></h2>
<p>Blender gives opportunity to temporary switch off any node in a tree. In this
case its input data paths through the node without any modifications toward next
nodes. Bas node class has default <code class="docutils literal notranslate"><span class="pre">sv_internal_links</span></code> property to determine
how the data should path a node. If default behaviour does not fit into a node
logic it can override the property. The property should return iterable tuple
of input and output sockets of the node.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Before implementing your own <code class="docutils literal notranslate"><span class="pre">sv_internal_links</span></code> property have a look at
the <code class="docutils literal notranslate"><span class="pre">utils/nodes_mixins/sockets_config</span></code> module. It has implementations
of the property for some basic node types.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Unfortunately the <code class="docutils literal notranslate"><span class="pre">sv_internal_links</span></code> property does not change how
internal links will be displayed in UI. Currently it’s limitation of Blender
which API does not give control of displaying internal links properly.</p>
</div>
</section>
<section id="nodes-with-dependencies">
<h2>Nodes With Dependencies<a class="headerlink" href="#nodes-with-dependencies" title="Link to this heading">¶</a></h2>
<p>Nodes can use some external library which can be installed manually by user from
Extra Nodes tab in the add-on settings. When a node uses external library and
it is not installed the node should add itself into a list of dummy nodes.
Dummy nodes do nothing but display information that a library is not installed.</p>
<figure class="align-right">
<a class="reference internal image-reference" href="https://user-images.githubusercontent.com/10011941/85948219-e3957800-b94f-11ea-9040-d1e3009dc016.png"><img alt="https://user-images.githubusercontent.com/10011941/85948219-e3957800-b94f-11ea-9040-d1e3009dc016.png" src="https://user-images.githubusercontent.com/10011941/85948219-e3957800-b94f-11ea-9040-d1e3009dc016.png" style="width: 250px;" /></a>
</figure>
<p>Also when library is not installed the nodes should not register their selves.
Also such nodes dose not apper in the Add node menu.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sverchok.dependencies</span> <span class="kn">import</span> <span class="n">FreeCAD</span>

<span class="k">if</span> <span class="n">FreeCAD</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">utils</span><span class="o">.</span><span class="n">dummy_nodes</span><span class="o">.</span><span class="n">add_dummy</span><span class="p">(</span><span class="s1">&#39;SvSolidAreaNode&#39;</span><span class="p">,</span> <span class="s1">&#39;Solid Area&#39;</span><span class="p">,</span> <span class="s1">&#39;FreeCAD&#39;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">SvSolidAreaNode</span><span class="p">:</span>
    <span class="o">...</span>

<span class="k">def</span> <span class="nf">register</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">FreeCAD</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">bpy</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">register_class</span><span class="p">(</span><span class="n">SvSolidAreaNode</span><span class="p">)</span>
</pre></div>
</div>
<p>The dependencies is a special module from which all dependent library should be
imported. If a library is not available instead of NoModuleFound error the
None value will be imported. The <code class="docutils literal notranslate"><span class="pre">add_dummy</span></code> function expects <code class="docutils literal notranslate"><span class="pre">bl_idname</span></code>
of the node, its name and name of the library on which the node is dependent.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>There is alternative and more simple way to handle the nodes with missing
dependencies. They should be registered as regular nodes but in their process
method they should raise an Error with a message which points that some
library should be installed to make the node to work.</p>
<p>The approach can handle the case when node is not dependent on a library
except in some of its modes.</p>
</div>
</section>
<section id="json-import-export">
<h2>JSON Import / Export<a class="headerlink" href="#json-import-export" title="Link to this heading">¶</a></h2>
<p>Sverchok has special format for sharing node trees and saving them into presets.
In most cases nodes developers should not prepare their node to make them work
with JSON import / export system. What is important to know:</p>
<ul class="simple">
<li><p>Standard json export saves all properties including collection and nesting
collection and pointers.</p></li>
<li><p>For now only data block names of pointer properties will be saved.</p></li>
<li><p>During import pointers will be searched in current scene, if there is no data
blocks with current name nothing will be assigned to the pointer.</p></li>
<li><p>It is strongly not recommended to save pointers for viewer nodes. For skipping
property to save use: <cite>BoolProperty(options={‘SKIP_SAVE’}</cite> it will impact only
on unsaving property into json file.</p></li>
<li><p>Custom properties (which uses square bracket interface) are ignored.</p></li>
<li><p>It is possible to add <cite>save_to_json(node_data: dict)</cite> and
<cite>load_from_json(node_data: dict, import_version: float)</cite> method to a node for
adding extra logic into import export, but it’s better to avoid using it.
It’s difficult to add changes into nodes using this methods and support import
previous JSON files.</p></li>
</ul>
</section>
<section id="upgrade-node">
<h2>Upgrade Node<a class="headerlink" href="#upgrade-node" title="Link to this heading">¶</a></h2>
<p>It’s possible to improve existing nodes but it should be done carefully, without
breaking existing layouts. It can be done in two ways:</p>
<section id="improve-existing-node">
<h3>Improve existing node<a class="headerlink" href="#improve-existing-node" title="Link to this heading">¶</a></h3>
<p>First is when you add extra functionality to some node. It’s possible by adding
extra buttons, sockets, modes. When you add something like this you should ensure
that default behaviour will be unchanged.</p>
<p>New socket, in most cases, can be placed anywhere among existing ones but it
should be checked in the process method that data from sockets is not collecting
by their indexes. Also there is no any automation and in old Blender files the
socket will be missing. So the socket should be added manually and currently
most appropriate place for this is the process method. It leads to some overhead
so probably in future there will be a special upgrade method for such things.
The socket should be optional and the node should be able to work without the
socket to be connected.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Also quite frequent case is socket renaming. It can be done by adding
<code class="docutils literal notranslate"><span class="pre">label</span></code> attribute with new name. Also for old files this should be
repeated in the process method.</p>
</div>
<p>Any property can be added to a node but it’s default value should not change
initial node behaviour.</p>
<p>It’s possible to add extra values to Enum properties but they always should be
placed in the end of the lists because Blender files keep current enum value
by its index.</p>
<p>All other changes should be done by creating new version of the node.</p>
</section>
<section id="create-new-node-version">
<h3>Create new node version<a class="headerlink" href="#create-new-node-version" title="Link to this heading">¶</a></h3>
<p>If it’s needed to fix some existing behaviour or remove one the new version of
a node should be introduced. It’s not necessary step when changes should be
applied to changes which were made in not released version of Sverchok. In this
case changes can be done with breaking backward compatibility.</p>
<p>Creating new version should be done togather with keeping previous one. In most
cases it’s enough <strong>to copy</strong> module of current node into old_nodes folder. It
should be done more carefully if in the module together with the node something
else is registered.</p>
<p>New version of the node should be created <strong>in the same module</strong> of initial
node by adding suffix to node class. Convention of the suffix is
<code class="docutils literal notranslate"><span class="pre">MKn</span></code> where <em>n</em> is index of new version. The same should be done to
<code class="docutils literal notranslate"><span class="pre">bl_idname</span></code> attribute of the class. New version of the node can implement
anything what can be implemented in new node.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>By changing class name and its <code class="docutils literal notranslate"><span class="pre">bl_idname</span></code> attribute, don’t forget to fix
these names in the registration functions and in the <code class="docutils literal notranslate"><span class="pre">index.md</span></code> file.</p>
</div>
<p>When new version is introduced it’s convenient to add replacement operator to
the old version of the node which automatically replace old node with new one
with keeping all connected links. This can be done by adding
<code class="docutils literal notranslate"><span class="pre">replacement_nodes</span></code> attribute. The operator will appear in the node context
menu.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Node</span><span class="p">:</span>
    <span class="n">replacement_nodes</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="n">new_node_bl_idname</span><span class="p">,</span> <span class="n">inputs_mapping_dict</span><span class="p">,</span> <span class="n">outputs_mapping_dict</span><span class="p">)</span>
    <span class="p">]</span>
</pre></div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">new_node_bl_idname</span></code> is <code class="docutils literal notranslate"><span class="pre">bl_idname</span></code> of replacement node class,
<code class="docutils literal notranslate"><span class="pre">inputs_mapping_dict</span></code> is a dictionary mapping names of inputs of this node
to names of inputs to new node, and <code class="docutils literal notranslate"><span class="pre">outputs_mapping_dict</span></code> is a dictionary
mapping names of outputs of this node to names of outputs of new node.
<code class="docutils literal notranslate"><span class="pre">inputs_mapping_dict</span></code> and <code class="docutils literal notranslate"><span class="pre">outputs_mapping_dict</span></code> can be None.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This attribute also can be used by regular node for quick replacement with
nodes which have similar functionality.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>When a node has multiple previous version the replacement operator should be
added (updated) to all of them.</p>
</div>
<p>Also the operator will try to copy all node properties by their names. If it’s
impossible it’s possible to copy properties manually by adding
<code class="docutils literal notranslate"><span class="pre">migrate_from(self,</span> <span class="pre">old_node)</span></code> method to new node. Also if some extra
work should be done with sockets it’s possible to implement in
<code class="docutils literal notranslate"><span class="pre">migrate_props_pre_relink(self,</span> <span class="pre">old_node)</span></code> method which will be called before
links creation.</p>
</section>
<section id="alpha-beta-node-state">
<h3>Alpha/Beta Node State<a class="headerlink" href="#alpha-beta-node-state" title="Link to this heading">¶</a></h3>
<p>When new node is created or existing version of a node is improved we usually
would like to have some time to catch and fix bugs. It can be done the better
the more people will test the node. Thus we have to merge changes into master.
But when node is in master users can save them in their layout and farther fixes
of the node can break them. To avoid this it’s possible to mark a node to show
to users that the node is in development state and that backwards incompatible
changes can be introduced. In order to do this Alpa or Beta icon should be
assigned to <code class="docutils literal notranslate"><span class="pre">sv_icon</span></code> attribute of the node class.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Node</span><span class="p">:</span>
    <span class="n">sv_icon</span> <span class="o">=</span> <span class="s1">&#39;SV_ALPHA`  # or &#39;</span><span class="n">SV_BETA</span><span class="s1">&#39;</span>
</pre></div>
</div>
<p>It’s recommended to mark new nodes and new version of existing node with
<em>in development</em> state if there are doubts in robustness of the nodes. A node
should lose the state when new Sverchok’s release is introduced.</p>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="add_new_node.html" class="btn btn-neutral float-left" title="Adding new Node" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="api_documentation.html" class="btn btn-neutral float-right" title="Sverchok API Documentation" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2014...2024, sverchok team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>